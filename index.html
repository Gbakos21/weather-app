<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Időjárás</title>

    <!-- Ikon -->
    <link rel="icon" href="weather-logo-icon.svg" type="image/svg+xml" />

    <!-- Bootstrap 5 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <style>
      /* ===== Alap téma változók ===== */
      :root {
        --from: #0ea5e9; /* dinamikus – időjárás szerint frissül */
        --to: #0369a1; /* dinamikus – időjárás szerint frissül */
        --accent: #0ea5e9; /* gombok, kiemelések */
        --panel-bg: rgba(
          255,
          255,
          255,
          0.78
        ); /* kevésbé átlátszó, hogy ne "olvadjon össze" a háttérrel */
        --panel-border: rgba(255, 255, 255, 0.7);
        --text-dim: #475569;
      }

      /* ===== Háttér + elsötétítés, hogy a tartalom olvasható maradjon ===== */
      body {
        min-height: 100vh;
        margin: 0;
        color: #0f172a;
        background: linear-gradient(
            180deg,
            rgba(2, 6, 23, 0.75),
            rgba(2, 6, 23, 0.55)
          ),
          radial-gradient(
            1200px 600px at 15% -10%,
            rgba(56, 189, 248, 0.35),
            transparent 60%
          ),
          radial-gradient(
            1100px 600px at 120% 120%,
            rgba(167, 139, 250, 0.35),
            transparent 60%
          ),
          url("walper.jpg") center/cover no-repeat fixed; /* a te háttérképed maradhat */
      }

      .app-wrap {
        max-width: 860px;
        margin: min(6vh, 4rem) auto;
        padding: clamp(1rem, 2vw, 1.5rem);
      }

      .panel {
        background: var(--panel-bg);
        border: 1px solid var(--panel-border);
        border-radius: 24px;
        box-shadow: 0 30px 60px rgba(0, 0, 0, 0.35);
        backdrop-filter: blur(12px) saturate(140%);
        -webkit-backdrop-filter: blur(12px) saturate(140%);
        position: relative;
      }

      /* Dísz-szegély a panel tetején – finom színátmenet */
      .panel::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 24px;
        pointer-events: none;
        background: linear-gradient(135deg, var(--from), var(--to));
        /* vendor + standard együtt a kompatibilitásért */
        -webkit-mask: linear-gradient(#000 0 0) content-box,
          linear-gradient(#000 0 0);
        mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
        -webkit-mask-composite: xor;
        mask-composite: exclude;

        padding: 2px;
        opacity: 0.45;
      }

      .brand-grad {
        background: linear-gradient(135deg, var(--from), var(--to));
        -webkit-background-clip: text;
        background-clip: text;
        color: transparent;
        text-shadow: none;
      }

      .lead-sub {
        color: var(--text-dim);
      }

      .search-area {
        background: rgba(255, 255, 255, 0.72);
        border-radius: 20px;
        padding: 1rem;
        border: 1px solid rgba(15, 23, 42, 0.06);
      }

      /* több hely a bal oldali input és a jobb oldali gombok között */
      .search-area .row {
        --bs-gutter-x: 1.25rem;
      }
      @media (min-width: 768px) {
        .search-area .row {
          --bs-gutter-x: 2.5rem;
        }
      }
      @media (min-width: 1200px) {
        .search-area .row {
          --bs-gutter-x: 3rem;
        }
      }
      @media (min-width: 768px) {
        .search-area .col-actions {
          padding-left: 0.5rem;
        }
      }

      /* Törés 768–930 px között: a gombok lemennek egy új sorba, így biztosan nem érnek össze az inputtal */
      @media (min-width: 768px) and (max-width: 930px) {
        .search-area .col-md-8,
        .search-area .col-actions {
          flex: 0 0 100% !important;
          max-width: 100% !important;
        }
        .search-area .col-actions {
          margin-top: 0.5rem !important;
          padding-left: 0 !important;
          justify-content: flex-start !important;
          display: grid !important;
          grid-auto-flow: column;
          gap: 0.5rem;
        }
      }

      .input-group-lg > .form-control,
      .input-group-lg > .input-group-text {
        height: 56px;
      }

      .btn-brand {
        --bs-btn-padding-y: 0.75rem;
        --bs-btn-padding-x: 1rem;
        --bs-btn-font-weight: 600;
        border: 0;
        border-radius: 14px;
        background-image: linear-gradient(135deg, var(--from), var(--to));
        color: white;
        box-shadow: 0 10px 22px rgba(14, 165, 233, 0.35);
        transition: transform 0.06s ease, box-shadow 0.2s ease, opacity 0.2s;
      }
      .btn-brand:hover {
        box-shadow: 0 14px 28px rgba(14, 165, 233, 0.45);
        opacity: 0.95;
      }
      .btn-brand:active {
        transform: translateY(1px);
      }

      .btn-ghost {
        border: 1px solid rgba(2, 6, 23, 0.12);
        background: #fff;
        color: #0f172a;
        font-weight: 600;
        border-radius: 14px;
        transition: background 0.2s ease, transform 0.06s ease;
      }
      .btn-ghost:hover {
        background: #f8fafc;
      }
      .btn-ghost:active {
        transform: translateY(1px);
      }

      .result-card {
        background: rgba(255, 255, 255, 0.78);
        border: 1px solid rgba(2, 6, 23, 0.06);
        border-radius: 18px;
      }
      .fade-in {
        animation: fade 0.25s ease both;
      }
      @keyframes fade {
        from {
          opacity: 0;
          transform: translateY(4px);
        }
        to {
          opacity: 1;
          transform: none;
        }
      }

      .icon-wrap {
        width: 64px;
        height: 64px;
        border-radius: 50%;
        display: grid;
        place-items: center;
        background: radial-gradient(
            circle at 30% 30%,
            rgba(2, 6, 23, 0.06),
            transparent 60%
          ),
          linear-gradient(135deg, #f1f5f9, #e2e8f0);
        border: 1px solid #e2e8f0;
      }
      .icon-wrap img {
        width: 56px;
        height: 56px;
      }

      .meta {
        font-size: 0.95rem;
        color: var(--text-dim);
      }

      footer {
        color: #0f172a;
        opacity: 0.85;
        font-size: 0.9rem;
      }
    </style>
  </head>
  <body>
    <main class="app-wrap">
      <section class="p-4 p-md-5 panel">
        <header class="text-center mb-4">
          <h1 class="display-6 fw-bold mb-1 brand-grad">
            <i class="bi bi-cloud-sun"></i> Időjárás lekérdezés
          </h1>
          <p class="lead lead-sub mb-0">
            Letisztult, kontrasztos UI. Város vagy tartózkodási hely alapján.
          </p>
        </header>

        <!-- Kereső -->
        <div class="search-area mb-3">
          <div class="row gy-3 gx-4 align-items-center">
            <div class="col-12 col-md-8">
              <label for="cityInput" class="form-label mb-1">Város neve</label>
              <div class="input-group input-group-lg">
                <span class="input-group-text bg-white"
                  ><i class="bi bi-geo-alt"></i
                ></span>
                <input
                  type="text"
                  class="form-control"
                  id="cityInput"
                  placeholder="Pl.: Budapest"
                />
              </div>
              <div class="form-text mt-1">
                Nyomj <kbd>Enter</kbd>-t a kereséshez.
              </div>
            </div>
            <div
              class="col-12 col-md-4 col-actions d-grid d-md-flex gap-2 justify-content-md-end mt-2 mt-md-4"
            >
              <button class="btn btn-brand btn-lg" id="btnCity">
                <i class="bi bi-search"></i> Keresés
              </button>
              <button class="btn btn-ghost btn-lg" id="btnGeo">
                <i class="bi bi-crosshair2"></i> Helyzetem
              </button>
            </div>
          </div>
        </div>

        <!-- Visszajelzések -->
        <div id="alert" class="alert d-none" role="alert"></div>

        <!-- Eredmény -->
        <div id="weather-container" class="result-card p-4 d-none">
          <div class="d-flex align-items-center gap-3">
            <div class="icon-wrap me-3">
              <img id="weather-icon" alt="Ikon" />
            </div>
            <div>
              <h2 id="place" class="h4 mb-1"></h2>
              <div class="meta">
                <span id="condition"></span>
                <span class="mx-2">•</span>
                <span id="feels"></span>
              </div>
            </div>
            <div class="ms-auto text-end">
              <div class="display-5 fw-bold" id="temperature">--°C</div>
              <div class="meta">
                <i class="bi bi-cloud-drizzle"></i>
                <span id="humidity"></span> páratartalom
              </div>
            </div>
          </div>
        </div>

        <footer class="mt-4 text-center">
          <small
            >Adatok: OpenWeather • Dinamikus háttér, biztos kontraszt, modern
            gombok • gbakos.hu</small
          >
        </footer>
      </section>
    </main>

    <script>
      // ===== Beállítások =====
      const API_KEY = "ac81dcd0d69a84ac753677885c962c61"; // a saját kulcsod – érdemes szerverről kiszolgálni
      const API_BASE = "https://api.openweathermap.org/data/2.5/weather";

      // ===== Elemszelektorok =====
      const cityInput = document.getElementById("cityInput");
      const btnCity = document.getElementById("btnCity");
      const btnGeo = document.getElementById("btnGeo");

      const container = document.getElementById("weather-container");
      const placeEl = document.getElementById("place");
      const temperatureEl = document.getElementById("temperature");
      const conditionEl = document.getElementById("condition");
      const feelsEl = document.getElementById("feels");
      const humidityEl = document.getElementById("humidity");
      const iconEl = document.getElementById("weather-icon");
      const alertBox = document.getElementById("alert");

      // ===== Segéd függvények =====
      const showAlert = (msg, type = "warning") => {
        alertBox.className = `alert alert-${type} fade-in`;
        alertBox.textContent = msg;
      };
      const hideAlert = () => {
        alertBox.className = "alert d-none";
        alertBox.textContent = "";
      };

      const setLoading = (loading) => {
        if (loading) {
          btnCity.disabled = btnGeo.disabled = true;
          btnCity.innerHTML =
            '<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>Keresés…';
        } else {
          btnCity.disabled = btnGeo.disabled = false;
          btnCity.innerHTML = '<i class="bi bi-search"></i> Keresés';
        }
      };

      const iconUrl = (code) =>
        `https://openweathermap.org/img/wn/${code}@2x.png`; // HTTPS!

      const renderWeather = (data) => {
        const { name, sys, main, weather } = data;
        const w = weather?.[0];
        placeEl.textContent = `${name ?? "Ismeretlen város"}${
          sys?.country ? ", " + sys.country : ""
        }`;
        temperatureEl.textContent = `${Math.round(main.temp)}°C`;
        conditionEl.textContent = w?.description
          ? capitalize(w.description)
          : "—";
        feelsEl.textContent = `Hőérzet: ${Math.round(main.feels_like)}°C`;
        humidityEl.textContent = `${main.humidity}%`;
        iconEl.src = iconUrl(w?.icon ?? "01d");
        iconEl.alt = w?.main ?? "Időjárás ikon";

        applyThemeByWeather(
          w?.main || "Default",
          (w?.icon || "01d").includes("d")
        );

        container.classList.remove("d-none");
        container.classList.add("fade-in");
      };

      const capitalize = (s = "") => s.charAt(0).toUpperCase() + s.slice(1);

      const fetchWeather = async (params) => {
        hideAlert();
        setLoading(true);
        try {
          const url = new URL(API_BASE);
          Object.entries({
            ...params,
            appid: API_KEY,
            units: "metric",
            lang: "hu",
          }).forEach(([k, v]) => url.searchParams.set(k, v));
          const res = await fetch(url);
          if (!res.ok) throw new Error("Hálózati hiba: " + res.status);
          const data = await res.json();
          if (!data?.main?.temp)
            throw new Error("Nem sikerült értelmezni a választ.");
          renderWeather(data);
        } catch (err) {
          console.error(err);
          showAlert(
            "Hoppá! Nem sikerült lekérdezni az időjárást. Ellenőrizd a városnevet vagy próbáld újra később.",
            "danger"
          );
        } finally {
          setLoading(false);
        }
      };

      // ===== Események =====
      btnCity.addEventListener("click", () => {
        const city = cityInput.value.trim();
        if (!city) return showAlert("Írj be egy városnevet!", "warning");
        fetchWeather({ q: city });
      });

      cityInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          e.preventDefault();
          btnCity.click();
        }
      });

      btnGeo.addEventListener("click", () => {
        hideAlert();
        if (!("geolocation" in navigator))
          return showAlert(
            "A böngésződ nem támogatja a helymeghatározást.",
            "warning"
          );
        setLoading(true);
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude: lat, longitude: lon } = pos.coords;
            fetchWeather({ lat, lon });
          },
          (err) => {
            console.warn(err);
            setLoading(false);
            showAlert(
              "Nem sikerült beolvasni a tartózkodási helyet. Engedélyezd a hozzáférést és próbáld újra.",
              "danger"
            );
          },
          { enableHighAccuracy: true, timeout: 10000 }
        );
      });

      // ===== Dinamikus téma az időjárás alapján =====
      function applyThemeByWeather(main, isDay) {
        const m = (main || "").toLowerCase();
        let from = "#0ea5e9",
          to = "#0369a1",
          accent = "#0ea5e9";
        if (m.includes("clear")) {
          if (isDay) {
            from = "#f59e0b";
            to = "#fb923c";
            accent = "#ea580c";
          } else {
            from = "#0ea5e9";
            to = "#1e3a8a";
            accent = "#38bdf8";
          }
        } else if (m.includes("cloud")) {
          from = "#64748b";
          to = "#334155";
          accent = "#475569";
        } else if (m.includes("rain") || m.includes("drizzle")) {
          from = "#60a5fa";
          to = "#0ea5e9";
          accent = "#0284c7";
        } else if (m.includes("snow")) {
          from = "#e2e8f0";
          to = "#94a3b8";
          accent = "#64748b";
        } else if (m.includes("thunder")) {
          from = "#a78bfa";
          to = "#4c1d95";
          accent = "#7c3aed";
        } else if (
          m.includes("mist") ||
          m.includes("haze") ||
          m.includes("fog") ||
          m.includes("smoke")
        ) {
          from = "#a8a29e";
          to = "#57534e";
          accent = "#78716c";
        }
        document.documentElement.style.setProperty("--from", from);
        document.documentElement.style.setProperty("--to", to);
        document.documentElement.style.setProperty("--accent", accent);
      }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
